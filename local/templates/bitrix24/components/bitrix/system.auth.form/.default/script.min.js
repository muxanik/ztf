BX.namespace("BX.Bitrix24.Helper");BX.Bitrix24.Helper={frameOpenUrl:"",frameCloseUrl:"",isOpen:false,frameNode:null,popupNodeWrap:null,curtainNode:null,popupNode:null,closeBtn:null,openBtn:null,popupLoader:null,topBar:null,topBarHtml:null,header:null,langId:null,reloadPath:null,ajaxUrl:"",currentStepId:"",notifyBlock:null,notifyNum:"",notifyText:"",notifyId:0,notifyButton:"",init:function(t){this.frameOpenUrl=t.frameOpenUrl||"";this.frameCloseUrl=t.frameCloseUrl||"";this.helpUpBtnText=t.helpUpBtnText||"";this.langId=t.langId||"";this.openBtn=t.helpBtn;this.notifyBlock=t.notifyBlock;this.reloadPath=t.reloadPath||"";this.ajaxUrl=t.ajaxUrl||"";this.currentStepId=t.currentStepId||"";this.notifyData=t.notifyData||null;this.runtimeUrl=t.runtimeUrl||null;this.notifyUrl=t.notifyUrl||"";this.helpUrl=t.helpUrl||"";this.notifyNum=t.notifyNum||"";this.popupLoader=BX.create("div",{attrs:{className:"bx-help-popup-loader"},children:[BX.create("div",{attrs:{className:"bx-help-popup-loader-text"},text:BX.message("B24_HELP_LOADER")})]});this.topBarHtml='<div class="bx-help-menu-title" onclick="BX.Bitrix24.Helper.reloadFrame(\''+this.reloadPath+"')\">"+BX.message("B24_HELP_TITLE")+'<span class="bx-help-blue">24</span></div>';this.topBar=BX.create("div",{attrs:{className:"bx-help-nav-wrap"},html:this.topBarHtml});this.header=BX("header");this.createFrame();this.createCloseBtn();this.createPopup();BX.bind(this.openBtn,"click",BX.proxy(this.show,this));BX.bind(this.openBtn,"click",BX.proxy(this.setBlueHeroView,this));BX.bind(window,"message",BX.proxy(function(t){t=t||window.event;if(typeof t.data.action=="undefined"){if(t.data.height&&this.isOpen)this.frameNode.style.height=t.data.height+"px";this.insertTopBar(typeof t.data=="object"?t.data.title:t.data);this._showContent()}if(t.data.action=="CloseHelper"){this.closePopup()}if(t.data.action=="ChangeHeight"){if(t.data.height>0){this.changeHeight(t.data.height)}}if(t.data.action=="SetCounter"){BX.Bitrix24.Helper.showNotification(t.data.num)}},this));BX.addCustomEvent("onTopPanelCollapse",function(){if(BX.Bitrix24.Helper.isOpen){BX.Bitrix24.Helper.show()}});if(t.needCheckNotify=="Y"){this.checkNotification()}},setBlueHeroView:function(){if(!this.currentStepId)return;BX.ajax.post(this.ajaxUrl,{sessid:BX.bitrix_sessid(),action:"setView",currentStepId:this.currentStepId},function(){})},createFrame:function(){this.frameNode=BX.create("iframe",{attrs:{className:"bx-help-frame",frameborder:0,name:"help",id:"help-frame"}});BX.bind(this.frameNode,"load",BX.proxy(function(){this.popupNode.scrollTop=0},this))},_showContent:function(){this.frameNode.style.opacity=1;if(this.topBar.classList){this.topBar.classList.add("bx-help-nav-fixed");this.topBar.classList.add("bx-help-nav-show")}else{BX.addClass(this.topBar,"bx-help-nav-fixed");BX.addClass(this.topBar,"bx-help-nav-show")}this.popupLoader.classList.remove("bx-help-popup-loader-show")},_setPosFixed:function(){document.body.style.width=document.body.offsetWidth+"px";document.body.style.overflow="hidden"},_clearPosFixed:function(){document.body.style.width="auto";document.body.style.overflow=""},createCloseBtn:function(){this.closeBtn=BX.create("div",{attrs:{className:"bx-help-close"},children:[BX.create("div",{attrs:{className:"bx-help-close-inner"}})]});BX.bind(this.closeBtn,"click",BX.proxy(this.closePopup,this))},insertTopBar:function(t){this.topBar.innerHTML=this.topBarHtml+t},createPopup:function(){this.curtainNode=BX.create("div",{attrs:{className:"bx-help-curtain"}});this.popupNode=BX.create("div",{children:[this.frameNode,this.topBar,this.popupLoader],attrs:{className:"bx-help-main"}});document.body.appendChild(this.curtainNode);document.body.appendChild(this.popupNode);document.body.appendChild(this.closeBtn)},closePopup:function(){clearTimeout(this.shadowTimer);clearTimeout(this.helpTimer);BX.unbind(this.popupNode,"transitionend",BX.proxy(this.loadFrame,this));BX.unbind(document,"keydown",BX.proxy(this._close,this));BX.unbind(document,"click",BX.proxy(this._close,this));if(this.popupNode.style.transition!==undefined)BX.bind(this.popupNode,"transitionend",BX.proxy(this._clearPosFixed,this));else this._clearPosFixed();this.popupNode.style.width=0;this.topBar.style.width=0;if(this.topBar.classList){this.topBar.classList.remove("bx-help-nav-fixed");this.closeBtn.classList.remove("bx-help-close-anim")}else{BX.removeClass(this.topBar,"bx-help-nav-fixed");BX.removeClass(this.closeBtn,"bx-help-close-anim")}this.topBar.style.top=this.getTopCord().top+"px";this.helpTimer=setTimeout(BX.proxy(function(){this.curtainNode.style.opacity=0;this.closeBtn.style.display="none";if(this.openBtn.classList)this.openBtn.classList.remove("help-block-active")},this),500);this.shadowTimer=setTimeout(BX.proxy(function(){this.frameNode.src=this.frameCloseUrl;this.popupNode.style.display="none";this.curtainNode.style.display="none";this.frameNode.style.opacity=0;this.frameNode.style.height=0;this.popupLoader.classList.remove("bx-help-popup-loader-show");BX.unbind(this.popupNode,"transitionend",BX.proxy(this._clearPosFixed,this));if(this.topBar.classList)this.topBar.classList.remove("bx-help-nav-show");else BX.removeClass(this.topBar,"bx-help-nav-show");this.isOpen=false},this),800)},show:function(t){if(typeof B24==="object")B24.goUp();if(typeof t==="string"){this.frameOpenUrl=this.frameOpenUrl+"&"+t}var e=this.getTopCord().top;var i=this.getTopCord().right;clearTimeout(this.shadowTimer);clearTimeout(this.helpTimer);this._setPosFixed();this.curtainNode.style.top=e+"px";this.curtainNode.style.width=this.getTopCord().right+"px";this.curtainNode.style.display="block";this.popupNode.style.display="block";this.popupNode.style.paddingTop=e+"px";this.topBar.style.top=e+"px";this.closeBtn.style.top=e-63+"px";this.closeBtn.style.left=i-63+"px";this.closeBtn.style.display="block";this.popupLoader.style.top=e+"px";if(this.openBtn.classList)this.openBtn.classList.add("help-block-active");if(this.popupNode.style.transition!==undefined){BX.bind(this.popupNode,"transitionend",BX.proxy(this.loadFrame,this))}else{this.loadFrame(null)}this.shadowTimer=setTimeout(BX.proxy(function(){this.curtainNode.style.opacity=1;if(this.closeBtn.classList)this.closeBtn.classList.add("bx-help-close-anim");else BX.addClass(this.closeBtn,"bx-help-close-anim")},this),25);this.helpTimer=setTimeout(BX.proxy(function(){this.popupNode.style.width=860+"px";this.topBar.style.width=860+"px";this.popupLoader.classList.add("bx-help-popup-loader-show");BX.bind(document,"keydown",BX.proxy(this._close,this));BX.bind(document,"click",BX.proxy(this._close,this));this.isOpen=true},this),300)},_close:function(t){t=t||window.event;var e=t.target||t.srcElement;if(t.type=="click"){BX.PreventDefault(t)}if(t.keyCode==27){this.closePopup()}while(e!=document.documentElement){if(e==this.popupNode||e==this.closeBtn||e==this.topBar){break}else if(e==document.body&&!t.keyCode){this.closePopup();break}e=e.parentNode}},loadFrame:function(t){if(t!==null){t=t||window.event;var e=t.target||t.srcElement;if(e==this.popupNode)this.frameNode.src=this.frameOpenUrl}else{this.frameNode.src=this.frameOpenUrl}},reloadFrame:function(t){this.frameNode.style.opacity=0;this.frameNode.src=t;if(this.topBar.classList)this.topBar.classList.remove("bx-help-nav-show");else BX.removeClass(this.topBar,"bx-help-nav-show");this.popupNode.scrollTop=0},getTopCord:function(){var t=BX.pos(this.header);return{top:t.bottom,right:t.right}},changeHeight:function(t){if(t>0)this.frameNode.style.height=t+"px"},showNotification:function(t){if(!isNaN(parseFloat(t))&&isFinite(t)&&t>0){var e='<div class="help-block-counter">'+(t>99?"99+":t)+"</div>"}else{e=""}this.setNotification(t)},showAnimateHero:function(url){if(!url)return;BX.ajax({method:"GET",dataType:"html",url:this.helpUrl+url,data:{},onsuccess:BX.proxy(function(res){if(res){BX.load([this.runtimeUrl],function(){eval(res)})}},this)})},setNotification:function(t,e){BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{sessid:BX.bitrix_sessid(),action:"setNotify",num:t,time:e},onsuccess:BX.proxy(function(t){},this)})},checkNotification:function(){BX.ajax({method:"POST",dataType:"json",url:this.notifyUrl,data:this.notifyData,onsuccess:BX.proxy(function(t){if(!isNaN(t.num)){this.showNotification(t.num);if(t.id){this.notifyId=t.id;this.notifyText=t.body;this.notifyButton=t.button}if(t.url)this.showAnimateHero(t.url)}else{this.setNotification("","hour")}},this),onfailure:BX.proxy(function(){this.setNotification("","hour")},this)})}};BX.namespace("BX.Bitrix24.SystemAuthForm");BX.Bitrix24.SystemAuthForm={licenseHandler:function(t){if(typeof t!=="object")return;var e=t.COUNTER_URL||"",i=t.LICENSE_PATH||"",s=t.HOST||"";BX.ajax.post(e,{action:"upgradeButton",host:s},BX.proxy(function(){document.location.href=i},this))}};
//# sourceMappingURL=script.map.js